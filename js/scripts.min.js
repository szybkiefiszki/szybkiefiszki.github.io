var app=angular.module("cardsApp",["ui.router","ngAnimate","ui-notification"]);app.config(function(r,t,e,a){a.setOptions({delay:3e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"bottom"}),t.hashPrefix(""),e.otherwise("/"),r.state({name:"default",url:"/",templateUrl:"panel.htm"}).state({name:"list",url:"/list",templateUrl:"list.htm"}).state({name:"test",url:"/test",templateUrl:"test.htm"})}),app.service("storage",function(){this.saveCards=function(r){var t=[];return r.forEach(function(r){t.push(JSON.stringify(r))}),localStorage.setItem("fastCards",t.join("|")),!0},this.getCards=function(){var r,t="",e=[],a=!0;return t=localStorage.getItem("fastCards"),""!=t&&null!=t||(t='{"question":"Gdzie urodził się Fryderyk Chopin?","answer":"Żelazowa Wola","active":true}|{"question":"W który roku zmarł Ludwig van Beethoven?","answer":"1827r."}|{"question":"W którym roku urodził się Wolfgang Amadeus Mozart?","answer":"1756r."}|{"question":"Gdzie umarł Johannes Brahms?","answer":"W Wiedniu"}|{"question":"W jakich latach żył Georg Friedrich Händel?","answer":"1685 - 1759"}'),t=t.split("|"),t.forEach(function(t){r=JSON.parse(t),a?(r.active=!0,a=!1):r.active=!1,r.hover=!1,r.success=void 0,e.push(r)}),e}}),app.service("helpers",function(){this.shuffle=function(r){for(var t,e,a=r.length;0!==a;)e=Math.floor(Math.random()*a),a-=1,t=r[a],r[a]=r[e],r[e]=t;return r}}),app.directive("fileread",[function(){return{scope:{fileread:"="},link:function(r,t,e){t.bind("change",function(t){var e=new FileReader;e.onload=function(t){r.$apply(function(){r.fileread=t.target.result})},e.readAsDataURL(t.target.files[0])})}}}]),app.controller("cardsCtrl",function(r,t,e,a,s,n){var c=this;c.loader=!0,c.image=null,c.imageText=null,c.question="",c.answer="",c.history=[],c.clock={start:0,current:0,interval:0},c.tests=[],c.cards=a.getCards(),c.cardsTest=c.cards,c.currentCard=0,c.saveHistory=function(){c.history.push(JSON.stringify(c.cards))},c.backHistory=function(){c.history.length>0&&(c.cards=JSON.parse(c.history[c.history.length-2]),c.history.splice(-1))},c.saveHistory(),c.toggleHover=function(r){c.cards[r].hover?c.cards[r].hover=!1:c.cards[r].hover=!0},c.removeCard=function(r){c.cards[r].active&&(c.changeCard(r+1),c.changeCard(r-1)),r<=c.currentCard&&c.currentCard--,c.cards.splice(r,1),c.saveHistory()},c.addCard=function(){""!=c.question&&""!=c.answer?(c.cards.push({image:c.image,imageText:c.imateText,question:c.question,answer:c.answer}),1==c.cards.length&&(c.cards[0].active=!0,c.currentCard=0),c.image=null,c.imageText=null,c.question="",c.answer="",c.saveHistory()):n.warning("Wprowadź pytanie i odpowiedź!")},c.changeCard=function(r){r>=0&&r<c.cards.length&&(c.cards[c.currentCard].active=!1,c.currentCard=r,c.cards[c.currentCard].active=!0,c.cards.forEach(function(r){r.hover=!1}))},c.testCard=function(r){1==r?c.cards[c.currentCard].success=!0:0==r&&(c.cards[c.currentCard].success=!1),c.currentCard+=1,c.currentCard==c.cards.length?c.stopTest():(c.cards[c.currentCard-1].active=!1,c.cards[c.currentCard-1].hover=!1,c.cards[c.currentCard].active=!0)},c.syncCards=function(){a.saveCards(c.cards)&&!c.notiSuccess&&n.success("Zapisano aktualny stan fiszek!")},c.startTest=function(){c.changeCard(0),c.clock.start=Date.now(),c.clock.current=Date.now(),c.clock.interval=e(function(){c.clock.current=Date.now()},1e3)},c.stopTest=function(){var r=0,t=0,a=[];e.cancel(c.clock.interval),c.cards.forEach(function(e){1==e.success&&t++,r++,a.push(e.success),e.success=void 0}),c.tests.push(a),c.currentCard=0,c.cards[c.cards.length-1].active=!1,c.cards[0].active=!0,n.primary("Twój wynik to: "+t+"/"+r+"<br/>Twój czas to: "+new Date(c.clock.current-c.clock.start-36e5).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")),c.clock.start=0,c.clock.current=0}});